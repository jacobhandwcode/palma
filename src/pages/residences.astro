---
import Layout from '../layouts/Layout.astro';
import PageHero from '../components/PageHero.astro';
import FloorPlans from '../components/FloorPlans.astro';
---

<Layout
  title="Residences | Palma Miami Beach | Luxury Miami Beach Condos"
  description="The fully furnished and finished residences at Palma Miami Beach feature impeccable floorplans, serving as both a sanctuary and an ideal entertaining space."
>
  <PageHero videoSrc="/videos/residences-video.mp4" title="Residences" />
  <section class="text-box no-bg">
    <p>
      The residences at <span>Palma</span> are a harmonious blend of elegance and
      comfort, designed to be your full-time home, a weekend getaway, or a flexible
      rental with no restrictions. Each space exudes Mediterranean charm with airy
      layouts, high ceilings, and handpicked finishes that evoke timeless beauty.
      Sunlight streams through expansive windows, illuminating open living areas
      that seamlessly flow into private terraces, many with water views. <span
        >Palma</span
      > offers unparalleled versatility that is delivered turn-key for you or your
      guests. Every detail is crafted to enhance your lifestyle, providing a serene
      retreat that remains connected to the vibrant energy of Miami Beach.
    </p>
  </section>
  <section class="overlapped-image-section">
    <div class="background-image">
      <img src="/images/residences/residence-collage.webp" alt="Balcony View" />
    </div>
    <div class="overlay-image">
      <img src="/images/residences/love-life.png" alt="Love Life" />
    </div>
  </section>
  <section class="img-txt left has-gallery">
    <div class="img-txt-content">
      <div class="content-wrapper">
        <h2>Residential Features</h2>
        <ul>
          <li>Beach-luxe residences with modern open layouts</li>
          <li>
            All residences are delivered fully finished and furnished by
            award-winning Studio Ramirez
          </li>
          <li>Panoramic ocean and bay views in select residences</li>
          <li>Private balconies for outdoor enjoyment from your home</li>
          <li>
            Luxurious 9-10 ft ceilings giving space and light to the feeling of
            your residence
          </li>
          <li>
            Floor-to-ceiling sliding glass doors with impact-resistant glass
          </li>
          <li>Advanced technology Smart Building</li>
          <li>Residences are pre-wired for high-speed internet</li>
          <li>Energy efficient central air conditioning and heating system</li>
          <li>Washer and dryer combo included with residence</li>
          <li>Spacious closets for your beach-chic wardrobe</li>
        </ul>
      </div>
    </div>
    <div class="img-txt-gallery">
      <div class="gallery-container-img-txt">
        <div class="gallery-slides">
          <div class="slide active">
            <img
              src="/images/residences/b1-living.webp"
              alt="Residential Feature 1"
            />
          </div>
          <div class="slide">
            <img
              src="/images/residences/a1-living.webp"
              alt="Residential Feature 2"
            />
          </div>
          <div class="slide">
            <img
              src="/images/residences/a6-living.webp"
              alt="Residential Feature 3"
            />
          </div>
        </div>
        <button class="gallery-arrow gallery-prev" aria-label="Previous image">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path
              d="M15 18L9 12L15 6"
              stroke="white"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
        </button>

        <button class="gallery-arrow gallery-next" aria-label="Next image">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path
              d="M9 18L15 12L9 6"
              stroke="white"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
        </button>

        <div class="gallery-dots">
          <button class="dot active" data-slide="0"></button>
          <button class="dot" data-slide="1"></button>
          <button class="dot" data-slide="2"></button>
        </div>
      </div>
    </div>
  </section>
  <section class="img-txt right">
    <div class="img-txt-content">
      <div class="content-wrapper">
        <h2>Kitchen</h2>
        <ul>
          <li>Imported European-cabinets with premium fittings</li>
          <li>
            Bosch appliance package with refrigerator, oven, cooktop, microwave,
            and dishwasher
          </li>
          <li>
            Premium stone countertops and backsplashes for the ultimate culinary
            experience
          </li>
          <li>Contemporary stainless steel under-mounted sink</li>
          <li>Elegant faucet with integrated spray handle</li>
        </ul>
      </div>
    </div>
    <div class="img-txt-image">
      <img src="/images/amenities/kitchen.webp" alt="Kitchen" />
    </div>
  </section>
  <section class="img-txt left">
    <div class="img-txt-content">
      <div class="content-wrapper">
        <h2>Primary Bathroom</h2>
        <ul>
          <li>
            Imported European cabinets with premium hardware and drawer pulls
          </li>
          <li>Premium stone countertops and backsplashes</li>
          <li>
            Rectangular trough porcelain sinks with dual elegant faucets (in
            select residences)
          </li>
          <li>Custom-finished porcelain floors and walls in wet areas</li>
          <li>Glass shower enclosures</li>
          <li>Premium European-style fixtures and accessories</li>
        </ul>
      </div>
    </div>
    <div class="img-txt-image">
      <img src="/images/amenities/bathroom.webp" alt="Primary Bathroom" />
    </div>
  </section>
  <section class="full-view-img-text">
    <div class="full-view-image">
      <img
        src="/images/residences/bedroom.webp"
        alt="Breathtaking Views of Miami Beach"
      />
    </div>
    <div class="full-view-text">
      <h2>Breathtaking Views of Miami Beach</h2>
    </div>
  </section>
  <section class="zoom-scroll-section" id="zoomSection">
    <div class="zoom-background">
      <img src="/images/residences/view.webp" alt="Miami Beach Views" />
    </div>
    <div class="zoom-content">
      <a href="https://sftp-bucket-inflightll.s3.amazonaws.com/customer/MENIN%20HOSPITALITY/PALMA/DELIVERABLES/360/DAY/04-05-24/WITH%20MENU/V1/index.html" target="_blank" class="experience-btn">Experience The Views</a>
    </div>
  </section>
  <FloorPlans />
</Layout>

<script>
  class HorizontalGallery {
    constructor() {
      // Check if required elements exist before initializing
      this.track = document.querySelector('.gallery-track');
      this.items = document.querySelectorAll('.gallery-item');
      this.prevBtn = document.querySelector('.gallery-prev');
      this.nextBtn = document.querySelector('.gallery-next');
      this.progressFill = document.querySelector('.progress-fill');

      // Only initialize if all required elements exist
      if (
        !this.track ||
        !this.items.length ||
        !this.prevBtn ||
        !this.nextBtn ||
        !this.progressFill
      ) {
        console.log(
          'HorizontalGallery: Required elements not found, skipping initialization'
        );
        return;
      }

      this.currentIndex = 0;
      this.itemsToShow = window.innerWidth <= 768 ? 1 : 2;
      this.totalItems = this.items.length;
      this.maxIndex = Math.max(0, this.totalItems - this.itemsToShow);

      this.init();
    }

    init() {
      if (!this.track) return; // Safety check

      this.updateProgress();
      this.prevBtn.addEventListener('click', () => this.prevSlide());
      this.nextBtn.addEventListener('click', () => this.nextSlide());

      window.addEventListener('resize', () => {
        this.itemsToShow = window.innerWidth <= 768 ? 1 : 2;
        this.maxIndex = Math.max(0, this.totalItems - this.itemsToShow);
        this.currentIndex = Math.min(this.currentIndex, this.maxIndex);
        this.updatePosition();
        this.updateProgress();
      });
    }

    prevSlide() {
      if (!this.track) return;

      if (this.currentIndex === 0) {
        this.currentIndex = this.maxIndex;
      } else {
        this.currentIndex--;
      }
      this.updatePosition();
      this.updateProgress();
    }

    nextSlide() {
      if (!this.track) return;

      if (this.currentIndex >= this.maxIndex) {
        this.currentIndex = 0;
      } else {
        this.currentIndex++;
      }
      this.updatePosition();
      this.updateProgress();
    }

    updatePosition() {
      if (!this.track) return;

      const itemWidth = 100 / this.itemsToShow;
      const translateX = -(this.currentIndex * itemWidth);
      this.track.style.transform = `translateX(${translateX}%)`;
    }

    updateProgress() {
      if (!this.progressFill) return;

      const progress =
        this.maxIndex > 0 ? (this.currentIndex / this.maxIndex) * 100 : 0;
      this.progressFill.style.width = `${progress}%`;
    }
  }

  class ZoomScrollEffect {
    constructor() {
      this.section = document.getElementById('zoomSection');

      // Only initialize if section exists
      if (!this.section) {
        console.log(
          'ZoomScrollEffect: Section not found, skipping initialization'
        );
        return;
      }

      this.image = this.section.querySelector('.zoom-background img');

      // Only initialize if image exists
      if (!this.image) {
        console.log(
          'ZoomScrollEffect: Image not found, skipping initialization'
        );
        return;
      }

      this.isInViewport = false;
      this.maxZoom = 1.3;
      this.minZoom = 1;

      this.init();
    }

    init() {
      this.observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            this.isInViewport = entry.isIntersecting;
          });
        },
        {
          threshold: 0.1,
          rootMargin: '50px 0px -50px 0px',
        }
      );

      this.observer.observe(this.section);
      window.addEventListener('scroll', () => this.handleScroll());
    }

    handleScroll() {
      if (!this.isInViewport || !this.image) return;

      const rect = this.section.getBoundingClientRect();
      const windowHeight = window.innerHeight;
      const sectionHeight = rect.height;

      let progress = 0;

      if (rect.top <= windowHeight && rect.bottom >= 0) {
        const visibleHeight =
          Math.min(windowHeight, rect.bottom) - Math.max(0, rect.top);
        const totalScrollableDistance = windowHeight + sectionHeight;
        const scrolledDistance = windowHeight - rect.top;

        progress = Math.max(
          0,
          Math.min(1, scrolledDistance / totalScrollableDistance)
        );
      }

      const zoomLevel = this.minZoom + progress * (this.maxZoom - this.minZoom);
      this.image.style.transform = `scale(${zoomLevel})`;
    }
  }

  class ImgTxtGallery {
    constructor(containerSelector = '.img-txt.has-gallery') {
      this.container = document.querySelector(containerSelector);

      // Only initialize if container exists
      if (!this.container) {
        console.log(
          'ImgTxtGallery: Container not found, skipping initialization'
        );
        return;
      }

      this.currentSlide = 0;
      this.slides = this.container.querySelectorAll('.slide');
      this.dots = this.container.querySelectorAll('.dot');
      this.prevBtn = this.container.querySelector('.gallery-prev');
      this.nextBtn = this.container.querySelector('.gallery-next');
      this.isTransitioning = false;

      // Only initialize if all required elements exist
      if (
        !this.slides.length ||
        !this.dots.length ||
        !this.prevBtn ||
        !this.nextBtn
      ) {
        console.log(
          'ImgTxtGallery: Required elements not found, skipping initialization'
        );
        return;
      }

      console.log(
        'ImgTxtGallery: Initializing with',
        this.slides.length,
        'slides'
      );
      this.init();
    }

    init() {
      this.prevBtn.addEventListener('click', () => this.prevSlide());
      this.nextBtn.addEventListener('click', () => this.nextSlide());

      this.dots.forEach((dot, index) => {
        dot.addEventListener('click', () => this.goToSlide(index));
      });

      this.startAutoplay();
      console.log('ImgTxtGallery: Initialized successfully');
    }

    prevSlide() {
      if (this.isTransitioning) return;
      console.log('ImgTxtGallery: Previous slide');
      const prevIndex =
        this.currentSlide === 0
          ? this.slides.length - 1
          : this.currentSlide - 1;
      this.goToSlide(prevIndex);
    }

    nextSlide() {
      if (this.isTransitioning) return;
      console.log('ImgTxtGallery: Next slide');
      const nextIndex =
        this.currentSlide === this.slides.length - 1
          ? 0
          : this.currentSlide + 1;
      this.goToSlide(nextIndex);
    }

    goToSlide(index) {
      if (this.isTransitioning || index === this.currentSlide) return;

      console.log('ImgTxtGallery: Going to slide', index);
      this.isTransitioning = true;

      this.slides[this.currentSlide].classList.remove('active');
      this.dots[this.currentSlide].classList.remove('active');
      this.slides[this.currentSlide].classList.add('zoom-out');

      setTimeout(() => {
        this.currentSlide = index;
        this.slides[this.currentSlide].classList.add('active', 'zoom-in');
        this.dots[this.currentSlide].classList.add('active');

        setTimeout(() => {
          this.slides.forEach((slide) => {
            slide.classList.remove('zoom-out', 'zoom-in');
          });
          this.isTransitioning = false;
          console.log('ImgTxtGallery: Transition complete');
        }, 2000);
      }, 1000);
    }

    startAutoplay() {
      this.autoplayInterval = setInterval(() => {
        if (!this.isTransitioning) {
          this.nextSlide();
        }
      }, 5000);
      console.log('ImgTxtGallery: Autoplay started');
    }
  }

  // Initialize classes when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing classes...');

    // Only initialize classes if their elements exist
    try {
      new HorizontalGallery();
    } catch (error) {
      console.log('HorizontalGallery initialization failed:', error);
    }

    try {
      new ZoomScrollEffect();
    } catch (error) {
      console.log('ZoomScrollEffect initialization failed:', error);
    }

    try {
      new ImgTxtGallery();
    } catch (error) {
      console.log('ImgTxtGallery initialization failed:', error);
    }
  });
</script>
