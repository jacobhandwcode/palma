---
import Layout from '../../layouts/Layout.astro';
import Hero from '../../components/Hero.astro';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

export function getStaticPaths() {
  return [
    { params: { lang: 'es' } },
    { params: { lang: 'pt' } }
  ];
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<Layout title={t('site.title')} description={t('site.description')} lang={lang}>
  <Hero lang={lang} />
  <section class="text-box" id="palma">
    <p>
      <span>{t('home.hero.title')}</span>
      {t('home.intro')}
    </p>
  </section>
  <section class="two-imgs">
    <div class="img-container">
      <img src="/images/home/hero-text.webp" alt={t('home.hero.title')} />
    </div>
    <div class="img-container">
      <img src="/images/home/golden-girl.webp" alt={t('home.hero.title')} />
    </div>
  </section>
  <section class="text-box-no-bg">
    <p>
      {t('home.location')}
    </p>
  </section>
  <section
    class="parralax-img"
    style="background-image: url('/images/home/sunset.webp');"
  >
  </section>
  <section class="funnel-cards">
    <div
      class="funnel-card"
      style="background-image: url('/images/home/residences.webp');"
    >
      <a
        href={lang === 'en' ? '/residences' : `/${lang}/residences`}
        class="card-link"
      >
        <h3>{t('home.residences')}</h3>
      </a>
    </div>
    <div
      class="funnel-card"
      style="background-image: url('/images/home/amenities.webp');"
    >
      <a
        href={lang === 'en' ? '/amenities' : `/${lang}/amenities`}
        class="card-link"
      >
        <h3>{t('home.amenities')}</h3>
      </a>
    </div>
    <div
      class="funnel-card"
      style="background-image: url('/images/home/neighborhood.webp');"
    >
      <a
        href={lang === 'en' ? '/neighborhood' : `/${lang}/neighborhood`}
        class="card-link"
      >
        <h3>{t('home.neighborhood')}</h3>
      </a>
    </div>
  </section>

  <section class="gallery">
    <div class="gallery-container-home">
      <div class="gallery-slides">
        <div class="slide active">
          <img src="/images/home/gym.webp" alt={t('gallery.gym')} />
        </div>
        <div class="slide">
          <img src="/images/home/pool.webp" alt={t('gallery.pool')} />
        </div>
        <div class="slide">
          <img src="/images/home/aqua-lounge.webp" alt={t('gallery.lobby')} />
        </div>
        <div class="slide">
          <img
            src="/images/home/pool-terrace.webp"
            alt={t('gallery.terrace')}
          />
        </div>
        <div class="slide">
          <img
            src="/images/home/living-space.webp"
            alt={t('gallery.bedroom')}
          />
        </div>
      </div>

      <button class="gallery-arrow gallery-prev" aria-label={t('gallery.prev')}>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path
            d="M15 18L9 12L15 6"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </button>

      <button class="gallery-arrow gallery-next" aria-label={t('gallery.next')}>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path
            d="M9 18L15 12L9 6"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </button>

      <div class="gallery-dots">
        <button class="dot active" data-slide="0"></button>
        <button class="dot" data-slide="1"></button>
        <button class="dot" data-slide="2"></button>
        <button class="dot" data-slide="3"></button>
        <button class="dot" data-slide="4"></button>
      </div>
    </div>
  </section>
</Layout>

<script>
  class Gallery {
    constructor() {
      this.currentSlide = 0;
      this.slides = document.querySelectorAll('.slide');
      this.dots = document.querySelectorAll('.dot');
      this.prevBtn = document.querySelector('.gallery-prev');
      this.nextBtn = document.querySelector('.gallery-next');
      this.isTransitioning = false;

      this.init();
    }

    init() {
      this.prevBtn.addEventListener('click', () => this.prevSlide());
      this.nextBtn.addEventListener('click', () => this.nextSlide());

      this.dots.forEach((dot, index) => {
        dot.addEventListener('click', () => this.goToSlide(index));
      });

      this.startAutoplay();
    }

    prevSlide() {
      if (this.isTransitioning) return;

      const prevIndex =
        this.currentSlide === 0
          ? this.slides.length - 1
          : this.currentSlide - 1;
      this.goToSlide(prevIndex);
    }

    nextSlide() {
      if (this.isTransitioning) return;

      const nextIndex =
        this.currentSlide === this.slides.length - 1
          ? 0
          : this.currentSlide + 1;
      this.goToSlide(nextIndex);
    }

    goToSlide(index) {
      if (this.isTransitioning || index === this.currentSlide) return;

      this.isTransitioning = true;

      this.slides[this.currentSlide].classList.remove('active');
      this.dots[this.currentSlide].classList.remove('active');

      this.slides[this.currentSlide].classList.add('zoom-out');

      setTimeout(() => {
        this.currentSlide = index;

        this.slides[this.currentSlide].classList.add('active', 'zoom-in');
        this.dots[this.currentSlide].classList.add('active');

        setTimeout(() => {
          this.slides.forEach((slide) => {
            slide.classList.remove('zoom-out', 'zoom-in');
          });
          this.isTransitioning = false;
        }, 2000);
      }, 1000);
    }

    startAutoplay() {
      setInterval(() => {
        if (!this.isTransitioning) {
          this.nextSlide();
        }
      }, 5000);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    new Gallery();
  });
</script>