---
import Layout from '../../layouts/Layout.astro';
import PageHero from '../../components/PageHero.astro';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

export function getStaticPaths() {
  return [{ params: { lang: 'es' } }, { params: { lang: 'pt' } }];
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<Layout
  title={t('amenities.meta.title')}
  description={t('amenities.meta.description')}
  lang={lang}
>
  <PageHero
    videoSrc="/videos/amenities-video.mp4"
    title={t('amenities.title')}
    lang={lang}
  />
  <section class="text-box no-bg">
    <p>
      {t('amenities.intro.start')}
      <span>Palma</span>
      {t('amenities.intro.middle')}
      <span>Palma</span>
      {t('amenities.intro.end')}
    </p>
  </section>
  <section
    class="parralax-img"
    style="background-image: url('/images/amenities/good-life.webp');"
  >
    <img src="/images/amenities/island-life-luxury.png" />
  </section>
  <section class="img-txt left">
    <div class="img-txt-content">
      <div class="content-wrapper">
        <h2>{t('amenities.building.features.title')}</h2>
        <ul>
          <li>{t('amenities.building.features.lobby')}</li>
          <li>{t('amenities.building.features.reception')}</li>
          <li>{t('amenities.building.features.security')}</li>
          <li>{t('amenities.building.features.smart')}</li>
          <li>{t('amenities.building.features.wifi')}</li>
          <li>{t('amenities.building.features.landmark')}</li>
          <li>{t('amenities.building.features.retail')}</li>
          <li>{t('amenities.building.features.beachClub')}</li>
        </ul>
      </div>
    </div>
    <div class="img-txt-image">
      <img
        src="/images/amenities/lobby.webp"
        alt={t('amenities.building.features.title')}
      />
    </div>
  </section>
  <section class="img-txt right">
    <div class="img-txt-content">
      <div class="content-wrapper">
        <h2>{t('amenities.building.amenities.title')}</h2>
        <ul>
          <li>{t('amenities.building.amenities.pool')}</li>
          <li>{t('amenities.building.amenities.kitchen')}</li>
          <li>{t('amenities.building.amenities.lounge')}</li>
          <li>{t('amenities.building.amenities.fitness')}</li>
          <li>{t('amenities.building.amenities.wellness')}</li>
        </ul>
      </div>
    </div>
    <div class="img-txt-image">
      <img
        src="/images/home/pool.webp"
        alt={t('amenities.building.amenities.title')}
      />
    </div>
  </section>
  <section class="dual-gallery">
    <div class="gallery-container-dual">
      <button
        class="gallery-arrow gallery-prev"
        aria-label={t('amenities.gallery.prev')}
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path
            d="M15 18L9 12L15 6"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </button>

      <div class="gallery-track">
        <div class="gallery-item">
          <img
            src="/images/home/pool-terrace.webp"
            alt={t('amenities.gallery.pool')}
          />
        </div>
        <div class="gallery-item">
          <img
            src="/images/home/aqua-lounge.webp"
            alt={t('amenities.gallery.pool')}
          />
        </div>
        <div class="gallery-item">
          <img src="/images/home/pool.webp" alt={t('amenities.gallery.pool')} />
        </div>
        <div class="gallery-item">
          <img src="/images/home/gym.webp" alt={t('amenities.gallery.pool')} />
        </div>
        <div class="gallery-item">
          <img
            src="/images/gallery-page/reception.webp"
            alt={t('amenities.gallery.pool')}
          />
        </div>
        <div class="gallery-item">
          <img
            src="/images/amenities/lobby.webp"
            alt={t('amenities.gallery.pool')}
          />
        </div>
      </div>

      <button
        class="gallery-arrow gallery-next"
        aria-label={t('amenities.gallery.next')}
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path
            d="M9 18L15 12L9 6"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </button>
    </div>

    <div class="progress-bar">
      <div class="progress-fill"></div>
    </div>
  </section>
  <section class="beach-club-section">
    <div class="main-content">
      <div class="content-text">
        <h2>{t('amenities.beachClub.title')}</h2>
        <p>
          {t('amenities.beachClub.description')}
        </p>
      </div>
      <div class="main-image">
        <img
          src="/images/amenities/beach-club.webp"
          alt={t('amenities.beachClub.title')}
        />
      </div>
    </div>

    <div class="image-grid">
      <div class="grid-item">
        <img
          src="/images/amenities/trees.webp"
          alt={t('amenities.beachClub.scene')}
        />
      </div>
      <div class="grid-item large">
        <img
          src="/images/amenities/woman.webp"
          alt={t('amenities.beachClub.relaxing')}
        />
      </div>
      <div class="grid-item">
        <img
          src="/images/amenities/champagne.webp"
          alt={t('amenities.beachClub.service')}
        />
      </div>
    </div>

    <div class="bottom-text">
      <h3>{t('amenities.beachClub.tagline')}</h3>
    </div>
  </section>
</Layout>

<script>
  class HorizontalGallery {
    constructor() {
      this.track = document.querySelector('.gallery-track');
      this.items = document.querySelectorAll('.gallery-item');
      this.prevBtn = document.querySelector('.gallery-prev');
      this.nextBtn = document.querySelector('.gallery-next');
      this.progressFill = document.querySelector('.progress-fill');

      this.currentIndex = 0;
      this.itemsToShow = window.innerWidth <= 875 ? 1 : 2;
      this.totalItems = this.items.length;
      this.maxIndex = Math.max(0, this.totalItems - this.itemsToShow);

      this.init();
    }

    init() {
      this.updateProgress();

      this.prevBtn.addEventListener('click', () => this.prevSlide());
      this.nextBtn.addEventListener('click', () => this.nextSlide());

      window.addEventListener('resize', () => {
        this.itemsToShow = window.innerWidth <= 875 ? 1 : 2;
        this.maxIndex = Math.max(0, this.totalItems - this.itemsToShow);
        this.currentIndex = Math.min(this.currentIndex, this.maxIndex);
        this.updatePosition();
        this.updateProgress();
      });
    }

    prevSlide() {
      if (this.currentIndex === 0) {
        this.currentIndex = this.maxIndex;
      } else {
        this.currentIndex--;
      }
      this.updatePosition();
      this.updateProgress();
    }

    nextSlide() {
      if (this.currentIndex >= this.maxIndex) {
        this.currentIndex = 0;
      } else {
        this.currentIndex++;
      }
      this.updatePosition();
      this.updateProgress();
    }

    updatePosition() {
      const itemWidth = 100 / this.itemsToShow;
      const translateX = -(this.currentIndex * itemWidth);
      this.track.style.transform = `translateX(${translateX}%)`;
    }

    updateProgress() {
      const progress =
        this.maxIndex > 0 ? (this.currentIndex / this.maxIndex) * 100 : 0;
      this.progressFill.style.width = `${progress}%`;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    new HorizontalGallery();
  });
</script>
